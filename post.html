<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>নতুন পোস্ট তৈরি করুন - কাজিপুর এক্সপ্রেস</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
<style>
:root {
  --brand: #006d63;
  --brand-light: #008577;
  --brand-dark: #00554d;
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --border: #e5e7eb;
  --success: #10b981;
  --error: #ef4444;
}
* { box-sizing: border-box; margin:0; padding:0; font-family:'Noto Sans Bengali', sans-serif; }
body { background: var(--bg); color: var(--text); line-height:1.6; }
.container { max-width: 900px; margin: 0 auto; padding: 20px; }
.header { background: var(--card); position: sticky; top:0; z-index:100; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
.header-inner { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; }
.brand img { width: 120px; }
.nav { display: flex; gap: 20px; }
.nav a { text-decoration: none; color: var(--text); font-weight:600; position: relative; }
.nav a.active, .nav a:hover { color: var(--brand); }
.nav a.active::after { content: ''; position: absolute; bottom: -4px; left:0; right:0; height:3px; background: var(--brand); border-radius: 3px 3px 0 0; }
.nav-toggle { display: none; background:none; border:none; font-size:24px; cursor:pointer; }
.page-header { margin: 30px 0; text-align:center; }
.page-title { font-size:2rem; color: var(--brand); margin-bottom:8px; }
.page-subtitle { color: var(--muted); font-size:16px; }
.form-container { background: var(--card); padding:30px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.05); }
.form-group { margin-bottom:20px; }
.form-label { display:block; margin-bottom:6px; font-weight:600; }
.form-input, .form-textarea, .form-select { width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:8px; font-size:16px; transition: all 0.3s; }
.form-input:focus, .form-textarea:focus, .form-select:focus { outline:none; border-color: var(--brand); box-shadow:0 0 0 3px rgba(0,109,99,0.1); }
.form-textarea { min-height:150px; resize: vertical; }
.form-row { display: flex; gap:15px; flex-wrap: wrap; }
.form-row .form-group { flex:1 1 48%; }
.form-actions { display:flex; gap:12px; flex-wrap: wrap; margin-top:20px; }
.btn { display:inline-flex; align-items:center; gap:8px; padding:10px 20px; border-radius:8px; font-weight:600; cursor:pointer; transition:0.3s; border:none; }
.btn-primary { background: var(--brand); color:white; }
.btn-primary:hover { background: var(--brand-light); }
.btn-outline { background:transparent; border:1px solid var(--border); color: var(--text); }
.btn-outline:hover { border-color: var(--brand); color: var(--brand); background: var(--bg); }
.image-preview { display:none; margin-top:12px; border-radius:8px; overflow:hidden; }
.image-preview img { width:100%; height:auto; display:block; }
.form-message { padding:12px; border-radius:8px; margin-top:16px; display:none; }
.form-message.success { background: rgba(16,185,129,0.1); color:var(--success); border:1px solid var(--success); display:block; }
.form-message.error { background: rgba(239,68,68,0.1); color:var(--error); border:1px solid var(--error); display:block; }
footer { background:#111827; color:white; padding:40px 20px; text-align:center; margin-top:40px; border-radius:12px 12px 0 0; }
@media(max-width:768px){
  .nav { display:none; flex-direction:column; gap:10px; }
  .nav.open { display:flex; position:absolute; top:60px; left:0; right:0; background:white; padding:20px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
  .nav-toggle { display:block; }
  .form-row .form-group { flex:1 1 100%; }
}
</style>
</head>
<body>

<header class="header">
  <div class="container header-inner">
    <button class="nav-toggle" id="navToggle"><i class="fas fa-bars"></i></button>
    <a href="index.html" class="brand"><img src="logo.png" alt="Logo"></a>
    <nav class="nav" id="mainNav">
      <a href="index.html" class="nav-link">হোম</a>
      <a href="post.html" class="nav-link active">পোস্ট তৈরি</a>
    </nav>
  </div>
</header>

<div class="container">
  <div class="page-header">
    <h1 class="page-title">নতুন পোস্ট তৈরি করুন</h1>
    <p class="page-subtitle">আপনার খবরটি শেয়ার করুন এবং ছবি আপলোড করুন</p>
  </div>
  <div class="form-container">
    <form id="postForm">
      <div class="form-group">
        <label class="form-label">শিরোনাম</label>
        <input type="text" class="form-input" id="postTitle" placeholder="খবরের শিরোনাম" required>
      </div>
      <div class="form-group">
        <label class="form-label">ক্যাটেগরি</label>
        <select class="form-select" id="postCategory" required>
          <option value="">ক্যাটেগরি নির্বাচন করুন</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">ছবি আপলোড</label>
        <button type="button" class="btn btn-primary" id="uploadWidgetBtn"><i class="fas fa-cloud-upload-alt"></i> ছবি আপলোড</button>
        <input type="hidden" id="postImage" value="">
        <div class="image-preview" id="imagePreview">
          <img src="" alt="Preview" id="previewImg">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">বিস্তারিত</label>
        <textarea class="form-textarea" id="postContent" placeholder="খবরের বিস্তারিত বর্ণনা" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">সারাংশ</label>
        <textarea class="form-textarea" id="postExcerpt" placeholder="সংক্ষিপ্তসার" required></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">সূত্র</label>
          <input type="text" class="form-input" id="postSource" placeholder="সূত্র">
        </div>
        <div class="form-group">
          <label class="form-label">লেখক</label>
          <input type="text" class="form-input" id="postAuthor" placeholder="লেখক">
        </div>
      </div>
      <div id="formMessage" class="form-message"></div>
      <div class="form-actions">
        <button type="reset" class="btn btn-outline"><i class="fas fa-times"></i> বাতিল</button>
        <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> পোস্ট করুন</button>
      </div>
    </form>
  </div>
</div>

<footer>
  <h3>কাজিপুর এক্সপ্রেস</h3>
  <p>&copy; ২০২৩ সকল অধিকার সংরক্ষিত</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCP6zCBnpY2IgIEPAtiAzuF6_83F4vU-xs",
  authDomain: "vip-news-aa9d1.firebaseapp.com",
  projectId: "vip-news-aa9d1",
  storageBucket: "vip-news-aa9d1.firebasestorage.app",
  messagingSenderId: "105863450293",
  appId: "1:105863450293:web:27d4c874ec3fef0184f8fc",
  measurementId: "G-TDRFDHC7ER"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const rtdb = firebase.database();

const navToggle = document.getElementById('navToggle');
const mainNav = document.getElementById('mainNav');
const postForm = document.getElementById('postForm');
const formMessage = document.getElementById('formMessage');
const uploadWidgetBtn = document.getElementById('uploadWidgetBtn');
const imagePreview = document.getElementById('imagePreview');
const previewImg = document.getElementById('previewImg');
const postImage = document.getElementById('postImage');
const postCategory = document.getElementById('postCategory');

navToggle.addEventListener('click', ()=>mainNav.classList.toggle('open'));

// Load categories dynamically
rtdb.ref('categories').on('value', snapshot=>{
  const categories = snapshot.val();
  postCategory.innerHTML = '<option value="">ক্যাটেগরি নির্বাচন করুন</option>';
  for(let key in categories){
    const option = document.createElement('option');
    option.value = categories[key].slug;
    option.textContent = categories[key].name;
    postCategory.appendChild(option);
  }
});

// Cloudinary
let cloudinaryWidget = null;
function initCloudinaryWidget(){
  cloudinaryWidget = cloudinary.createUploadWidget({
    cloudName:'dhvtgzy5x',
    uploadPreset:'Rosenews',
    sources:['local','url','camera'],
    multiple:false,
    cropping:true
  },(error,result)=>{
    if(!error && result && result.event==="success"){
      postImage.value = result.info.secure_url;
      previewImg.src = result.info.secure_url;
      imagePreview.style.display='block';
    }
  });
}
uploadWidgetBtn.addEventListener('click',()=>{
  if(!cloudinaryWidget) initCloudinaryWidget();
  cloudinaryWidget.open();
});

// Submit
postForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const user = auth.currentUser;
  if(!user){
    formMessage.textContent = 'লগইন করুন।';
    formMessage.className = 'form-message error';
    return;
  }
  if(!postImage.value){
    formMessage.textContent = 'ছবি আপলোড করুন।';
    formMessage.className = 'form-message error';
    return;
  }
  const postData = {
    postId:`post_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,
    title:document.getElementById('postTitle').value,
    category:postCategory.value,
    content:document.getElementById('postContent').value,
    excerpt:document.getElementById('postExcerpt').value,
    source:document.getElementById('postSource').value,
    author:document.getElementById('postAuthor').value,
    imageUrl:postImage.value,
    createdAt:firebase.firestore.FieldValue.serverTimestamp(),
    views:0
  };
  try{
    await db.collection('news').doc(postData.postId).set(postData);
    formMessage.textContent = 'পোস্ট সফলভাবে তৈরি হয়েছে!';
    formMessage.className='form-message success';
    postForm.reset();
    imagePreview.style.display='none';
  }catch(err){
    formMessage.textContent = `পোস্ট ব্যর্থ: ${err.message}`;
    formMessage.className='form-message error';
  }
});

auth.onAuthStateChanged(user=>{
  if(!user) window.location.href='index.html';
});
</script>
</body>
</html>