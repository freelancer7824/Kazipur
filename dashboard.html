 <!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ড্যাশবোর্ড</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background: #f5f6f8;
      font-family: 'Noto Sans Bengali', sans-serif;
      margin: 0;
      padding-bottom: 50px;
    }

    /* Header / Navbar */
    .header {
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .header img {
      height: 40px;
      object-fit: contain;
    }
    .header h2 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }
    .user-menu {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .user-menu span {
      color: #555;
      font-size: 14px;
    }
    .user-menu button {
      background: #f44336;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Top Navbar Buttons */
    .top-nav-buttons {
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      padding: 10px 0;
      margin-bottom: 20px;
    }
    .top-nav-buttons .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      color: #555;
      text-decoration: none;
      transition: 0.2s;
      margin: 5px;
      flex: 1 0 10%; /* 10 buttons fit */
    }
    .top-nav-buttons .nav-btn i {
      font-size: 18px;
      margin-bottom: 2px;
    }
    .top-nav-buttons .nav-btn:hover {
      color: #2196F3;
    }
    @media (max-width: 768px) {
      .top-nav-buttons .nav-btn { flex: 1 0 20%; font-size: 10px; }
    }
    @media (max-width: 480px) {
      .top-nav-buttons .nav-btn { flex: 1 0 25%; font-size: 10px; }
    }

    /* Dashboard Cards */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .dash-card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: 0.3s;
    }
    .dash-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .dash-icon {
      font-size: 28px;
      padding: 15px;
      border-radius: 50%;
      color: #fff;
    }
    .icon-blue { background: #2196F3; }
    .icon-green { background: #4CAF50; }
    .icon-orange { background: #FF9800; }
    .icon-red { background: #F44336; }
    .icon-purple { background: #9C27B0; }
    .dash-content { flex: 1; }
    .dash-number {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    .dash-label {
      font-size: 14px;
      color: #777;
      margin-top: 4px;
    }

    /* Chart Card */
    .chart-card {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    @media (max-width: 768px) {
      .dashboard-cards { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 480px) {
      .dashboard-cards { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div style="display: flex; align-items: center; gap: 10px;">
        <img src="logo.png" alt="Logo">
        <h2>ড্যাশবোর্ড</h2>
      </div>
      <div class="user-menu">
        <span>স্বাগতম, <strong id="username">Admin</strong></span>
        <button id="logoutBtn">লগআউট</button>
      </div>
    </div>
  </header>

  <!-- Top Navbar Buttons -->
  <div class="top-nav-buttons">
    <a href="index.html" class="nav-btn"><i class="fas fa-home"></i> হোম</a>
    <a href="marquee.html" class="nav-btn"><i class="fas fa-tachometer-alt"></i> ব্রেকিং নিউজ</a>
    <a href="post_list.html" class="nav-btn"><i class="fas fa-file-alt"></i> পোস্ট</a>
    <a href="post.html" class="nav-btn"><i class="fas fa-plus-circle"></i> নতুন পোস্ট</a>
    <a href="category.html" class="nav-btn"><i class="fas fa-list"></i>নতুন ক্যাটাগরি</a>
    <a href="users.html" class="nav-btn"><i class="fas fa-users"></i> ইউজার</a>
    <a href="live.html" class="nav-btn"><i class="fas fa-chart-bar"></i> লাইভ নিউজ</a>
    <a href="profile.html" class="nav-btn"><i class="fas fa-user"></i> প্রোফাইল</a>
    <a href="settings.html" class="nav-btn"><i class="fas fa-cog"></i> সেটিংস</a>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div class="dashboard-cards">
      <div class="dash-card">
        <div class="dash-icon icon-blue"><i class="fas fa-file-alt"></i></div>
        <div class="dash-content">
          <div class="dash-number" id="totalPosts">0</div>
          <div class="dash-label">মোট পোস্ট</div>
        </div>
      </div>
      <div class="dash-card">
        <div class="dash-icon icon-green"><i class="fas fa-check-circle"></i></div>
        <div class="dash-content">
          <div class="dash-number" id="publishedPosts">0</div>
          <div class="dash-label">প্রকাশিত</div>
        </div>
      </div>
      <div class="dash-card">
        <div class="dash-icon icon-orange"><i class="fas fa-pencil-alt"></i></div>
        <div class="dash-content">
          <div class="dash-number" id="draftPosts">0</div>
          <div class="dash-label">খসড়া</div>
        </div>
      </div>
      <div class="dash-card">
        <div class="dash-icon icon-purple"><i class="fas fa-calendar-day"></i></div>
        <div class="dash-content">
          <div class="dash-number" id="todayPosts">0</div>
          <div class="dash-label">আজকের পোস্ট</div>
        </div>
      </div>
      <div class="dash-card">
        <div class="dash-icon icon-red"><i class="fas fa-users"></i></div>
        <div class="dash-content">
          <div class="dash-number" id="totalUsers">0</div>
          <div class="dash-label">ইউজার</div>
        </div>
      </div>
      <div class="dash-card">
        <div class="dash-icon icon-green"><i class="fas fa-eye"></i></div>
        <div class="dash-content">
          <div class="dash-number" id="totalVisitors">0</div>
          <div class="dash-label">ভিজিটর</div>
        </div>
      </div>
    </div>

    <div class="chart-card">
      <h3 style="margin-bottom: 15px;">মাসভিত্তিক পোস্ট পরিসংখ্যান</h3>
      <canvas id="postsChart"></canvas>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const totalPosts = document.getElementById('totalPosts');
    const publishedPosts = document.getElementById('publishedPosts');
    const draftPosts = document.getElementById('draftPosts');
    const todayPosts = document.getElementById('todayPosts');
    const totalUsers = document.getElementById('totalUsers');
    const totalVisitors = document.getElementById('totalVisitors');
    const username = document.getElementById('username');
    const logoutBtn = document.getElementById('logoutBtn');

    async function loadDashboardData() {
      try {
        const querySnapshot = await db.collection('news').get();
        let posts = [];
        querySnapshot.forEach(doc => posts.push(doc.data()));

        totalPosts.textContent = posts.length;
        publishedPosts.textContent = posts.filter(p => (p.status || 'published') === 'published').length;
        draftPosts.textContent = posts.filter(p => p.status === 'draft').length;

        const today = new Date(); today.setHours(0,0,0,0);
        todayPosts.textContent = posts.filter(p => {
          if (!p.createdAt) return false;
          const d = p.createdAt.toDate();
          d.setHours(0,0,0,0);
          return d.getTime() === today.getTime();
        }).length;

        const usersSnap = await db.collection('users').get();
        totalUsers.textContent = usersSnap.size;

        const visitorRef = db.collection('stats').doc('visitors');
        await visitorRef.set({ count: firebase.firestore.FieldValue.increment(1) }, { merge: true });
        const visitorDoc = await visitorRef.get();
        totalVisitors.textContent = visitorDoc.exists ? visitorDoc.data().count : 0;

        renderMonthlyChart(posts);
      } catch (err) { console.error(err); }
    }

    function renderMonthlyChart(posts) {
      const monthlyCounts = new Array(12).fill(0);
      posts.forEach(p => {
        if (p.createdAt) {
          const d = p.createdAt.toDate();
          monthlyCounts[d.getMonth()]++;
        }
      });
      const ctx = document.getElementById('postsChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['জানু', 'ফেব্রু', 'মার্চ', 'এপ্রিল', 'মে', 'জুন', 'জুলাই', 'আগস্ট', 'সেপ্টে', 'অক্টো', 'নভে', 'ডিসে'],
          datasets: [{ label: 'পোস্ট সংখ্যা', data: monthlyCounts, backgroundColor: '#2196F3' }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { precision: 0 } } } }
      });
    }

    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => window.location.href = 'index.html').catch(err => console.error(err));
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        username.textContent = user.displayName || user.email;
        loadDashboardData();
      } else {
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html