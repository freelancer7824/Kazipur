<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>সব জনপ্রিয় খবর</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="index.html" class="brand">কাজিপুর এক্সপ্রেস</a>
    </div>
  </header>

  <div class="container" style="margin-top:100px;">
    <h2 class="section-title">জনপ্রিয় খবর</h2>
    <div class="grid" id="allPopularPosts">
      <!-- JS থেকে সব পোস্ট লোড হবে -->
    </div>
  </div>

  <footer class="footer">
    <div class="container">&copy; ২০২৩ কাজিপুর এক্সপ্রেস </div>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    async function loadAllPopularPosts() {
      try {
        const querySnapshot = await db.collection('news')
          .orderBy('views', 'desc')
          .get();

        const container = document.getElementById('allPopularPosts');
        container.innerHTML = '';

        if (querySnapshot.empty) {
          container.innerHTML = '<p>কোনো জনপ্রিয় খবর পাওয়া যায়নি</p>';
          return;
        }

        querySnapshot.forEach((doc) => {
          const news = doc.data();
          const postId = doc.id;
          const formattedDate = formatBengaliDate(news.createdAt);

          container.innerHTML += `
            <article class="card">
              <img src="${news.imageURL || 'placeholder.png'}" alt="${news.title}" class="thumb">
              <div class="card-body">
                <h3 class="title">${news.title}</h3>
                <p class="excerpt">${news.excerpt.substring(0,150)}...</p>
                <div class="meta">
                  <small>${formattedDate}</small>
                  <small><i class="fas fa-eye"></i> ${news.views || 0}</small>
                </div>
                <a href="open.html?postId=${postId}" class="btn btn-outline" style="margin-top:10px;">পুরো পড়ুন</a>
              </div>
            </article>
          `;
        });
      } catch (error) {
        console.error('Error loading popular posts:', error);
        document.getElementById('allPopularPosts').innerHTML = '<p>খবর লোড করতে সমস্যা হচ্ছে</p>';
      }
    }

    function formatBengaliDate(timestamp) {
      if (!timestamp) return 'তারিখ নেই';
      const date = timestamp.toDate();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('bn-BD', options);
    }

    document.addEventListener('DOMContentLoaded', loadAllPopularPosts);
  </script>
</body>
</html>